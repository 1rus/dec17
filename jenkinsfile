node ('docker') {
    cleanWs()
    stage('checkout scm') {
	checkout scm
    }
    def pythonImage
    def imageName="python/360:build"
    stage('build docker image'){
        bat "docker build -t ${imageName}  ."
        pythonImage = docker.image(imageName)
    }
    stage('test'){
        pythonImage.inside{
            bat "tmp\\dtest\\venv\\scripts\\activate.bat && python3 -m pytest --junitxml=testreport/results.xml"
        }
    }
    stage('collect test results'){
        junit "testreport/results.xml"
    }
}